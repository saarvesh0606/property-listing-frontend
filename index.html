<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Listing Frontend</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                    },
                }
            }
        }
    </script>
    <style>
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 4rem auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* For staggering animations */
        .card-container > div {
            opacity: 0;
            animation: fadeInUp 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 antialiased">
    <div id="root"></div>

    <!-- React, ReactDOM, and Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Your React Application Code -->
    <script type="text/babel" data-presets="react">
        const { useState, useEffect, useMemo, StrictMode } = React;
        const { createRoot } = ReactDOM;

        const API_BASE_URL = 'https://property-listing-backend-z97s.onrender.com/'; 

        // --- SVG Icons ---
        const SunIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-yellow-500"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>;
        const MoonIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-blue-300"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>;
        const SearchIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clipRule="evenodd" /></svg>;
        const FilterIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2a1 1 0 01-.293.707L16 11.414V16a1 1 0 01-.293.707l-2 2A1 1 0 0113 18v-6.586l-3.707-3.707A1 1 0 019 7V4a1 1 0 011-1H3z" /></svg>;
        const LogoIcon = () => <svg className="h-8 w-8 text-blue-600 dark:text-blue-500" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg>;
        const TrashIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>;

        // --- HELPER COMPONENTS ---
        const PropertyCard = ({ property, onView, onDelete, style }) => (
            <div style={style} className="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden group transition-all duration-300 hover:shadow-2xl hover:-translate-y-1">
                <div className="relative">
                    <img src={property.image} alt={property.name} className="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300" />
                    <div className="absolute top-0 left-0 w-full h-full bg-gradient-to-t from-black/60 to-transparent"></div>
                    <div className="absolute bottom-0 left-0 p-4">
                        <h3 className="text-xl font-bold text-white">{property.name}</h3>
                        <p className="text-sm text-blue-200">{property.location}</p>
                    </div>
                     <button onClick={() => onDelete(property.id)} className="absolute top-3 right-3 p-2 bg-red-600/80 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 hover:bg-red-700">
                        <TrashIcon />
                    </button>
                </div>
                <div className="p-4">
                    <p className="text-gray-600 dark:text-gray-300 text-sm mb-4 h-10">{property.description.substring(0, 80)}...</p>
                    <div className="flex justify-between items-center">
                        <p className="text-xl font-extrabold text-blue-600 dark:text-blue-400">${property.price.toLocaleString()}</p>
                        <button onClick={() => onView(property)} className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg">
                            View Details
                        </button>
                    </div>
                </div>
            </div>
        );

        const ViewDetailsModal = ({ property, onClose }) => {
            if (!property) return null;
            return ReactDOM.createPortal(
                <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex justify-center items-center z-50 p-4 animate-fade-in-up" style={{ animationDuration: '0.3s' }}>
                    <div className="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full overflow-hidden">
                        <div className="relative">
                            <img src={property.image} alt={property.name} className="w-full h-72 object-cover"/>
                            <button onClick={onClose} className="absolute top-4 right-4 bg-white/20 text-white rounded-full p-2 hover:bg-white/40 transition-all">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        </div>
                        <div className="p-8">
                            <h2 className="text-4xl font-extrabold mb-2 text-gray-900 dark:text-white">{property.name}</h2>
                            <div className="flex items-center text-gray-500 dark:text-gray-400 mb-6">
                                <span className="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-sm font-semibold mr-3 px-3 py-1 rounded-full">{property.type}</span>
                                <span className="text-lg">&bull;</span>
                                <span className="ml-3">{property.location}</span>
                            </div>
                            <p className="text-gray-700 dark:text-gray-300 mb-6 text-lg leading-relaxed">{property.description}</p>
                            <p className="text-4xl font-bold text-blue-600 dark:text-blue-400">${property.price.toLocaleString()}</p>
                        </div>
                    </div>
                </div>,
                document.body
            );
        };

        const AddPropertyForm = ({ onAdd, onCancel, isSubmitting }) => {
            const [name, setName] = useState('');
            const [type, setType] = useState('Plot');
            const [price, setPrice] = useState('');
            const [location, setLocation] = useState('');
            const [description, setDescription] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!name || !price || !location || !description) return;
                onAdd({ name, type, price: Number(price), location, description });
            };

            return (
                <div className="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl animate-fade-in-up">
                    <h2 className="text-3xl font-bold mb-6 text-gray-900 dark:text-white">Add a New Property</h2>
                    <form onSubmit={handleSubmit} className="space-y-6">
                        <input type="text" placeholder="Property Name" value={name} onChange={e => setName(e.target.value)} className="w-full p-4 rounded-lg bg-gray-100 dark:bg-gray-700 border-2 border-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                        <select value={type} onChange={e => setType(e.target.value)} className="w-full p-4 rounded-lg bg-gray-100 dark:bg-gray-700 border-2 border-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none">
                            <option value="Plot">Plot</option>
                            <option value="Shed">Shed</option>
                            <option value="Retail Store">Retail Store</option>
                        </select>
                        <input type="number" placeholder="Price ($)" value={price} onChange={e => setPrice(e.target.value)} className="w-full p-4 rounded-lg bg-gray-100 dark:bg-gray-700 border-2 border-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                        <input type="text" placeholder="Location (e.g., City, State)" value={location} onChange={e => setLocation(e.target.value)} className="w-full p-4 rounded-lg bg-gray-100 dark:bg-gray-700 border-2 border-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                        <textarea placeholder="Full Description" value={description} onChange={e => setDescription(e.target.value)} className="w-full p-4 rounded-lg bg-gray-100 dark:bg-gray-700 border-2 border-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows={4}></textarea>
                        <div className="flex justify-end space-x-4 pt-2">
                            <button type="button" onClick={onCancel} disabled={isSubmitting} className="bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-white font-bold py-3 px-6 rounded-lg transition-colors disabled:opacity-50">Cancel</button>
                            <button type="submit" disabled={isSubmitting} className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors disabled:opacity-50 shadow-lg hover:shadow-xl">
                                {isSubmitting ? 'Submitting...' : 'Add Property'}
                            </button>
                        </div>
                    </form>
                </div>
            );
        };

        // --- MAIN APP COMPONENT ---
        function App() {
            const [properties, setProperties] = useState([]);
            const [selectedProperty, setSelectedProperty] = useState(null);
            const [showAddForm, setShowAddForm] = useState(false);
            const [filterType, setFilterType] = useState('All');
            const [searchTerm, setSearchTerm] = useState('');
            const [isDarkMode, setIsDarkMode] = useState(false);
            const [isSubmitting, setIsSubmitting] = useState(false);
            
            const [status, setStatus] = useState('loading');
            const [error, setError] = useState(null);

            useEffect(() => {
                const fetchProperties = async () => {
                    setStatus('loading');
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/properties`);
                        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                        const data = await response.json();
                        setProperties(data);
                        setStatus('ready');
                    } catch (e) {
                        setError("Could not connect to the backend. Please ensure the server is running.");
                        setStatus('error');
                    }
                };
                fetchProperties();
            }, []);

            const filteredProperties = useMemo(() => properties.filter(p => 
                (filterType === 'All' || p.type === filterType) &&
                (!searchTerm || p.name.toLowerCase().includes(searchTerm.toLowerCase()) || p.location.toLowerCase().includes(searchTerm.toLowerCase()))
            ), [properties, filterType, searchTerm]);

            useEffect(() => {
                document.documentElement.classList.toggle('dark', isDarkMode);
            }, [isDarkMode]);

            const handleAddProperty = async (newPropertyData) => {
                setIsSubmitting(true);
                setError(null);
                try {
                    const response = await fetch(`${API_BASE_URL}/api/properties`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(newPropertyData),
                    });
                    if (!response.ok) throw new Error('Failed to add property');
                    const addedProperty = await response.json();
                    setProperties(prev => [addedProperty, ...prev]);
                    setShowAddForm(false);
                } catch (e) {
                    setError("Failed to add property. Please try again.");
                } finally {
                    setIsSubmitting(false);
                }
            };

            const handleDeleteProperty = async (propertyId) => {
                if (!window.confirm("Are you sure you want to delete this property? This action cannot be undone.")) {
                    return;
                }

                const originalProperties = [...properties];
                // Optimistic UI update: remove the property from the list immediately.
                setProperties(prevProperties => prevProperties.filter(p => p.id !== propertyId));

                try {
                    const response = await fetch(`${API_BASE_URL}/api/properties/${propertyId}`, {
                        method: 'DELETE',
                    });

                    if (!response.ok) {
                        // If the server responds with an error, revert the change.
                        throw new Error('Failed to delete on the server.');
                    }
                } catch (e) {
                    console.error("Error deleting property:", e);
                    setError("Could not delete property. Please try again.");
                    // Rollback the optimistic update if the API call fails
                    setProperties(originalProperties);
                }
            };
            
            const renderContent = () => {
                if (status === 'loading') return <div className="loader"></div>;
                if (status === 'error') return <div className="text-center py-16 text-red-500"><h3 className="text-2xl font-semibold">Something went wrong</h3><p className="mt-2">{error}</p></div>;
                if (filteredProperties.length > 0) {
                    return (
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 card-container">
                            {filteredProperties.map((prop, index) => (
                                <PropertyCard key={prop.id} property={prop} onView={setSelectedProperty} onDelete={handleDeleteProperty} style={{ animationDelay: `${index * 50}ms` }}/>
                            ))}
                        </div>
                    );
                }
                return (
                     <div className="text-center py-24 animate-fade-in-up">
                        <h3 className="text-3xl font-semibold text-gray-700 dark:text-gray-300">No Properties Found</h3>
                        <p className="text-gray-500 mt-4">Try adjusting your filters or add a new property!</p>
                    </div>
                );
            }

            return (
                <div className="min-h-screen">
                    {/* Header */}
                    <header className="bg-white/70 dark:bg-gray-800/70 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
                        <div className="container mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex items-center justify-between h-20">
                                <div className="flex items-center space-x-3">
                                    <LogoIcon />
                                    <h1 className="text-2xl font-bold text-gray-800 dark:text-white">PropertyFinder</h1>
                                </div>
                                <div className="flex items-center space-x-4">
                                    <button onClick={() => setShowAddForm(true)} className="hidden sm:flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                                        <span>Add Property</span>
                                    </button>
                                    <button onClick={() => setIsDarkMode(!isDarkMode)} className="p-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                                         {isDarkMode ? <SunIcon /> : <MoonIcon />}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="container mx-auto p-4 sm:p-6 lg:p-8">
                        {showAddForm ? (
                            <AddPropertyForm 
                                onAdd={handleAddProperty} 
                                onCancel={() => setShowAddForm(false)} 
                                isSubmitting={isSubmitting} 
                            />
                        ) : (
                            <React.Fragment>
                                <div className="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md mb-10">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div className="relative">
                                            <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"><SearchIcon /></div>
                                            <input type="text" placeholder="Search by name or location..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="w-full p-4 pl-12 rounded-lg bg-gray-100 dark:bg-gray-700 border-2 border-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                                        </div>
                                        <div className="relative">
                                            <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"><FilterIcon /></div>
                                            <select value={filterType} onChange={e => setFilterType(e.target.value)} className="w-full p-4 pl-12 rounded-lg bg-gray-100 dark:bg-gray-700 border-2 border-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none">
                                                <option value="All">All Property Types</option>
                                                <option value="Plot">Plot</option>
                                                <option value="Shed">Shed</option>
                                                <option value="Retail Store">Retail Store</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                {renderContent()}
                            </React.Fragment>
                        )}
                        
                        {/* Add Property Button for Mobile */}
                        {!showAddForm && (
                            <button onClick={() => setShowAddForm(true)} className="sm:hidden fixed bottom-6 right-6 bg-blue-600 hover:bg-blue-700 text-white font-bold p-4 rounded-full shadow-xl z-30 transition-transform transform hover:scale-110">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>
                            </button>
                        )}

                        <ViewDetailsModal property={selectedProperty} onClose={() => setSelectedProperty(null)} />
                    </main>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<StrictMode><App /></StrictMode>);
    </script>
</body>
</html>
